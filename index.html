<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üå± Sentient Plant Dashboard</title>

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #a8e6cf, #dcedc1);
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
        margin: 0;
        padding-top: 30px;
      }

      h1 {
        font-size: 2.5rem;
        color: #2e7d32;
        margin-bottom: 20px;
        text-shadow: 1px 1px 2px #fff;
      }

      .card {
        background: #ffffffcc;
        backdrop-filter: blur(8px);
        border-radius: 16px;
        padding: 20px;
        margin: 10px;
        width: 320px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .label {
        font-size: 1rem;
        color: #555;
      }

      .value {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 8px;
      }

      .emoji {
        font-size: 2rem;
        float: right;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        width: 90%;
        max-width: 800px;
      }

      footer {
        position: absolute;
        bottom: 10px;
        font-size: 0.8rem;
        color: #555;
      }

      .progress {
        height: 10px;
        width: 100%;
        background-color: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-bar {
        height: 100%;
        background-color: #66bb6a;
        width: 0%;
        transition: width 1s ease;
      }

      .status {
        font-size: 1.2rem;
        font-style: italic;
        margin-top: 8px;
      }
    </style>
  </head>

  <body>
    <h1>üåø Sentient Plant Dashboard</h1>

    <div class="grid">
      <div class="card" id="temp-card">
        <div class="label">Temperature üå°Ô∏è</div>
        <div class="value" id="temp">-- ¬∞C</div>
        <div class="progress">
          <div class="progress-bar" id="temp-bar"></div>
        </div>
      </div>

      <div class="card" id="hum-card">
        <div class="label">Humidity üíß</div>
        <div class="value" id="hum">-- %</div>
        <div class="progress">
          <div class="progress-bar" id="hum-bar"></div>
        </div>
      </div>

      <div class="card" id="moist-card">
        <div class="label">Soil Moisture ü™¥</div>
        <div class="value" id="moist">--</div>
        <div class="status" id="moist-status">Detecting...</div>
        <div class="progress">
          <div class="progress-bar" id="moist-bar"></div>
        </div>
      </div>

      <div class="card" id="light-card">
        <div class="label">Light Sensor ‚òÄÔ∏è</div>
        <div class="value" id="light">--</div>
        <div class="status" id="light-status">Detecting...</div>
        <div class="progress">
          <div class="progress-bar" id="light-bar"></div>
        </div>
      </div>

      <div class="card" id="water-card">
        <div class="label">Water Level üö∞</div>
        <div class="value" id="water">--</div>
        <div class="status" id="water-status">Detecting...</div>
        <div class="progress">
          <div class="progress-bar" id="water-bar"></div>
        </div>
      </div>
    </div>

    <footer>Data from ThingSpeak (update every 15s)</footer>

    <script>
      const CHANNEL_ID = "3100636";
      const READ_API_KEY = "TZET6YN9J2QU0NYM";
      const UPDATE_INTERVAL = 15000;

      async function fetchData() {
        try {
          const res = await fetch(
            `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=1`
          );
          const data = await res.json();
          const latest = data.feeds[0];

          const temp = parseFloat(latest.field1);
          const hum = parseFloat(latest.field2);
          const moist = parseInt(latest.field3);
          const light = parseInt(latest.field4);
          const water = parseInt(latest.field5);

          updateDashboard(temp, hum, moist, light, water);
        } catch (err) {
          console.error("Error fetching data:", err);
        }
      }

      function updateDashboard(temp, hum, moist, light, water) {
        // Set values
        document.getElementById("temp").textContent = `${temp.toFixed(1)} ¬∞C`;
        document.getElementById("hum").textContent = `${hum.toFixed(1)} %`;
        document.getElementById("moist").textContent = moist;
        document.getElementById("light").textContent = light;
        document.getElementById("water").textContent = water;

        // Bars
        document.getElementById("temp-bar").style.width = `${
          (temp / 50) * 100
        }%`;
        document.getElementById("hum-bar").style.width = `${hum}%`;
        document.getElementById("moist-bar").style.width = `${mapRange(
          4095 - moist,
          0,
          4095,
          0,
          100
        )}%`;
        document.getElementById("light-bar").style.width = `${mapRange(
          4095 - light,
          0,
          4095,
          0,
          100
        )}%`;
        document.getElementById("water-bar").style.width = `${mapRange(
          water,
          0,
          4095,
          0,
          100
        )}%`;

        // Moisture status
        const moistStatus = document.getElementById("moist-status");
        if (moist > 2500) moistStatus.textContent = "Dry üåµ - Needs water!";
        else if (moist < 1200) moistStatus.textContent = "Too Wet üí¶";
        else moistStatus.textContent = "Perfect üåø";

        // Light status
        const lightStatus = document.getElementById("light-status");
        if (light < 1000) lightStatus.textContent = "Bright ‚òÄÔ∏è";
        else if (light > 3000) lightStatus.textContent = "Dark üåô";
        else lightStatus.textContent = "Normal ‚õÖ";

        // Water level status
        const waterStatus = document.getElementById("water-status");
        if (water > 2800) waterStatus.textContent = "Full üíß";
        else if (water < 1200) waterStatus.textContent = "Low üö±";
        else waterStatus.textContent = "OK üí¶";
      }

      function mapRange(value, inMin, inMax, outMin, outMax) {
        return ((value - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin;
      }

      fetchData();
      setInterval(fetchData, UPDATE_INTERVAL);
    </script>
  </body>
</html>
